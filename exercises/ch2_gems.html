<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Lesson 2 â€” Treasure Chest (lists)</title>

  <!-- Your styles -->
  <link rel="stylesheet" href="../assets/styles.css">

  <!-- Pin PyScript to a specific release -->
  <link rel="stylesheet" href="https://pyscript.net/releases/2024.6.1/core.css">
  <script type="module" src="https://pyscript.net/releases/2024.6.1/core.js"></script>

  <!-- HUD helper -->
  <script defer src="../assets/app.js"></script>
</head>
<body>
  <div class="card">
    <a href="../index.html">â† Back</a>
    <h1>Lesson 2: Treasure Chest (lists)</h1>
    <p>Add a <code>diamond</code>, then print the first and last gems.</p>

    <div class="hud">
      <div id="stars" class="badge">â­ Stars: 0</div>
      <div id="bugs" class="badge bug">ğŸ Bugs: 0</div>
    </div>

    <textarea id="editor" class="editor"># Start with Peter's treasure chest
gems = ["ruby", "emerald", "sapphire"]

# 1) Add "diamond" to the END of the list
gems.append("diamond")

# 2) Print the FIRST and the LAST gems on one line
print(gems[0], gems[-1])
</textarea>

    <p><button id="run">Run â–¶</button></p>
    <pre id="out"></pre>
  </div>

  <py-script>
from js import document, localStorage
import io, sys

# Capture print() output
class Capture:
    def __enter__(self):
        self._old = sys.stdout
        self.buf = io.StringIO()
        sys.stdout = self.buf
        return self.buf
    def __exit__(self, *args):
        sys.stdout = self._old

def gi(k):
    v = localStorage.getItem(k)
    try:
        return int(v) if v is not None else 0
    except:
        return 0

def setb(stars=None, bugs=None):
    if stars is not None:
        localStorage.setItem('stars', str(stars))
    if bugs is not None:
        localStorage.setItem('bugs', str(bugs))
    document.getElementById('stars').textContent = f'â­ Stars: {gi("stars")}'
    document.getElementById('bugs').textContent  = f'ğŸ Bugs: {gi("bugs")}'

def run(evt):
    ns = {}
    src = document.getElementById('editor').value
    try:
        with Capture() as cap:
            exec(src, ns)
        out = cap.getvalue().strip()

        # Tests
        assert 'gems' in ns and isinstance(ns['gems'], list), "You need a list named gems."
        assert 'diamond' in ns['gems'], "You must append 'diamond' to the list."
        parts = out.split()
        assert len(parts) >= 2, "Please print the first and last items."
        assert parts[0].lower() == 'ruby', "First printed item should be ruby."
        assert parts[-1].lower() == 'diamond', "Last printed item should be diamond."

        document.getElementById('out').textContent = 'All checks passed! â­'
        setb(stars=gi('stars')+1)
    except Exception as e:
        document.getElementById('out').textContent = 'Bug found: ' + str(e)
        setb(bugs=gi('bugs')+1)

document.getElementById('run').addEventListener('click', run)
setb()
  </py-script>
</body>
</html>
