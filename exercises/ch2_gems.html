<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Lesson 2 â€” Treasure Chest (lists)</title>

  <link rel="stylesheet" href="../assets/styles.css">
  <link rel="stylesheet" href="https://pyscript.net/releases/2024.6.1/core.css">
  <script type="module" src="https://pyscript.net/releases/2024.6.1/core.js"></script>
  <script defer src="../assets/app.js"></script>
</head>
<body>
  <div class="card">
    <a href="../index.html">â† Back</a>
    <a class="btn" style="float:right" href="https://YOUR-PRO-URL.pages.dev/" target="_blank" rel="noopener">Go Pro â–¶</a>

    <img class="peter-hero" src="../assets/img/peter-lesson2.webp" alt="Peter with treasure chest">

    <h1>Lesson 2: Treasure Chest (lists)</h1>

    <div class="learnbox" id="explain2">
      <h4>Why this?</h4>
      <ul class="kids-list">
        <li>A <b>list</b> is a treasure chest that holds many items. Weâ€™ll add a new gem and peek at the first and last spots.</li>
      </ul>
      <h4>What youâ€™ll type</h4>
      <ul class="kids-list">
        <li>Create a list, append <code>"diamond"</code>, then <code>print</code> the first and last items.</li>
      </ul>
      <div class="ttsbar">
        <button class="btn ghost" onclick="readBySelector('#explain2')">ğŸ”Š Read this aloud</button>
      </div>
    </div>

    <div class="hud">
      <div id="stars" class="badge">â­ Stars: 0</div>
      <div id="bugs" class="badge bug">ğŸ Bugs: 0</div>
    </div>

    <div class="toolbar">
      <button id="starter" class="btn ghost" type="button">Insert Starter</button>
      <button id="hintBtn" class="btn ghost" type="button">Show Hint</button>
      <button id="solBtn" class="btn ghost" type="button">Show Solution</button>
    </div>

    <textarea id="editor" class="editor" placeholder="# 1) Make list\n# 2) Append 'diamond'\n# 3) Print first and last"></textarea>

    <p>
      <button id="run" class="btn" type="button">Run â–¶</button>
      <a class="btn ghost" href="p1_hello_name.html">Next: Practice 1 â†’</a>
      <a class="btn" href="https://YOUR-PRO-URL.pages.dev/" target="_blank" rel="noopener">Go Pro â–¶</a>
    </p>
    <pre id="out"></pre>

    <details id="hint" style="display:none"><summary>Hint</summary>
      <div class="small"><code>gems = ["ruby","emerald","sapphire"]</code> â†’ <code>gems.append("diamond")</code> â†’ <code>print(gems[0], gems[-1])</code></div>
    </details>
    <details id="sol" style="display:none"><summary>Solution (exact)</summary>
      <pre>gems = ["ruby", "emerald", "sapphire"]
gems.append("diamond")
print(gems[0], gems[-1])</pre>
    </details>
  </div>

  <script type="py">
from js import document, localStorage, window
from pyodide.ffi import create_proxy
import io, sys

STARTER = 'gems = ["ruby", "emerald", "sapphire"]\n# add diamond, then print first and last\n# print(gems[0], gems[-1])\n'

class Capture:
    def __enter__(self):
        self._old = sys.stdout
        self.buf = io.StringIO()
        sys.stdout = self.buf
        return self.buf
    def __exit__(self, *args):
        sys.stdout = self._old

def gi(k):
    v = localStorage.getItem(k)
    try: return int(v) if v is not None else 0
    except: return 0

def setb(stars=None, bugs=None):
    if stars is not None: localStorage.setItem('stars', str(stars))
    if bugs  is not None: localStorage.setItem('bugs',  str(bugs))
    document.getElementById('stars').textContent = f"â­ Stars: {gi('stars')}"
    document.getElementById('bugs').textContent  = f"ğŸ Bugs: {gi('bugs')}"

def insert_starter(evt):
    document.getElementById('editor').value = STARTER

def toggle_hint(evt):
    h = document.getElementById('hint')
    h.style.display = 'block' if h.style.display == 'none' else 'none'

def toggle_sol(evt):
    s = document.getElementById('sol')
    s.style.display = 'block' if s.style.display == 'none' else 'none'

def run(evt):
    src = document.getElementById('editor').value
    if not src.strip():
        document.getElementById('out').textContent = "Type your code first ğŸ™‚"
        return
    try:
        ns = {}
        with Capture() as cap:
            exec(src, ns)
        out = cap.getvalue().strip()

        assert 'gems' in ns and isinstance(ns['gems'], list), "Need a list named gems."
        assert 'diamond' in ns['gems'], "Append 'diamond' to the list."
        parts = out.split()
        document.getElementById('out').textContent = f"Your output:\n{out}\n\nExpected:\nruby diamond"
        assert len(parts) >= 2 and parts[0].lower()=='ruby' and parts[-1].lower()=='diamond', \
            "Please print first and last: ruby diamond"

        document.getElementById('out').textContent += "\n\nAll checks passed! â­"
        setb(stars=gi('stars')+1)
        window.launchConfetti(); window.playConfettiSound()
    except Exception as e:
        document.getElementById('out').textContent += f"\n\nBug found: {e}"
        setb(bugs=gi('bugs')+1)

document.getElementById('starter').addEventListener('click', create_proxy(insert_starter))
document.getElementById('hintBtn').addEventListener('click', create_proxy(toggle_hint))
document.getElementById('solBtn').addEventListener('click', create_proxy(toggle_sol))
document.getElementById('run').addEventListener('click', create_proxy(run))
setb()
  </script>
</body>
</html>
