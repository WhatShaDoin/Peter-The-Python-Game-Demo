<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Practice 3 ‚Äî Math Treasure</title>
  <meta name="description" content="Use two functions: greet(name) and add(a, b). Then print ruby diamond from a list.">

  <link rel="stylesheet" href="../assets/styles.css?v=3">
  <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css">
  <script defer src="https://pyscript.net/latest/pyscript.js"></script>

  <script>
    window.readBySelector ||= function(sel){
      const el = document.querySelector(sel);
      if(!el) return;
      const text = el.innerText.replace(/\s+/g,' ').trim();
      if('speechSynthesis' in window){
        speechSynthesis.cancel();
        speechSynthesis.speak(new SpeechSynthesisUtterance(text));
      }
    };
  </script>

  <script>
    window.P3_START = `def greet(name):
    # print Hello, NAME! (uppercase)
    pass

def add(a, b):
    # return the sum
    pass

def do_math_treasure(name, chest):
    # 1) call greet(name)
    # 2) print add(2, 3)
    # 3) print chest[0], chest[1]
    pass
`;
    window.P3_SOLN = `def greet(name):
    print("Hello, " + name.upper() + "!")

def add(a, b):
    return a + b

def do_math_treasure(name, chest):
    greet(name)
    print(add(2, 3))
    print(chest[0], chest[1])
`;
  </script>

  <script defer src="../assets/app.js"></script>
</head>
<body>
<div class="container">
  <div class="card" id="card">
    <a href="../index.html">‚Üê Back</a>
    <a class="btn" style="float:right" href="https://YOUR-PRO-URL.pages.dev/" target="_blank" rel="noopener">Go Pro ‚ñ∂</a>

    <h1>Practice 3: Math Treasure</h1>
    <p><b>Name:</b> <span id="nm">Zoe</span> ‚Ä¢ <b>Chest:</b> <code>['ruby','diamond','sapphire']</code></p>

    <div class="learnbox" id="why">
      <h4>Why?</h4>
      <p>Use <b>two functions</b> together and peek into a list.</p>
      <h4>What you‚Äôll type</h4>
      <ul>
        <li>Make <code>greet(name)</code> and <code>add(a, b)</code>.</li>
        <li>Make <code>do_math_treasure(name, chest)</code> that calls <code>greet</code>, prints <code>add(2, 3)</code>, then prints the first two gems.</li>
      </ul>
      <div class="ttsbar">
        <button class="btn ghost" onclick="readBySelector('#why')">üîä Read this aloud</button>
      </div>
    </div>

    <div class="hud">
      <div id="stars" class="badge">‚≠ê Stars: 0</div>
      <div id="bugs" class="badge bug">üêû Bugs: 0</div>
    </div>

    <div class="toolbar">
      <button id="fill-start" class="btn">Insert Starter</button>
      <button id="show-hint" class="btn ghost" onclick="document.getElementById('hint').open = true">Show Hint</button>
      <button id="fill-solution" class="btn ghost">Show Solution</button>
    </div>

    <textarea id="editor" class="editor" placeholder="Type your functions here..."></textarea>

    <p>
      <button id="run" class="btn">Run ‚ñ∂</button>
      <a class="btn ghost" href="../index.html" style="margin-left:.4rem">Back to Home ‚Üí</a>
    </p>

    <pre id="out"></pre>

    <details id="hint" style="margin-top:.6rem">
      <summary><b>Hint</b></summary>
      <ul>
        <li><code>print("Hello, " + name.upper() + "!")</code></li>
        <li><code>return a + b</code></li>
        <li><code>print(chest[0], chest[1])</code></li>
      </ul>
    </details>
  </div>
</div>

<py-script>
from js import document, localStorage, window, P3_START, P3_SOLN
import random, re, sys, io

names = ["Kai","Ava","Milo","Zoe","Lia","Noah","Ivy","Owen","Maya","Leo"]
NAME = random.choice(names)
document.getElementById('nm').textContent = NAME

def gi(k):
    v = localStorage.getItem(k)
    try: return int(v) if v is not None else 0
    except: return 0

def setb(stars=None, bugs=None):
    if stars is not None: localStorage.setItem('stars', str(stars))
    if bugs is not None: localStorage.setItem('bugs', str(bugs))
    document.getElementById('stars').textContent = f'‚≠ê Stars: {gi("stars")}'
    document.getElementById('bugs').textContent  = f'üêû Bugs: {gi("bugs")}'

def run(evt):
    ns = {}
    src = document.getElementById('editor').value
    out_el = document.getElementById('out')
    f = io.StringIO()
    try:
        exec(src, ns)
        for fn in ('greet','add','do_math_treasure'):
            assert fn in ns, f"Make the function {fn}(...)."

        chest = ['ruby','diamond','sapphire']
        old = sys.stdout; sys.stdout = f
        try:
            ns['do_math_treasure'](NAME, chest)
        finally:
            sys.stdout = old

        output = f.getvalue()
        up = output.upper()

        assert ("HELLO " + NAME.upper() + "!") in up, "Say 'Hello, NAME!' (uppercase)."
        assert "5" in output, "Should print the result of add(2, 3) which is 5."
        assert "ruby" in output and "diamond" in output, "Print the first two gems."

        out_el.textContent = "All checks passed! ‚≠ê"
        setb(stars=gi('stars')+1)
        try: window.confetti()
        except: pass
    except Exception as e:
        out_el.textContent = "Bug found: " + str(e)
        setb(bugs=gi('bugs')+1)

document.getElementById('run').addEventListener('click', run)

def fill_start(evt): document.getElementById('editor').value = P3_START
def fill_solution(evt): document.getElementById('editor').value = P3_SOLN
document.getElementById('fill-start').addEventListener('click', fill_start)
document.getElementById('fill-solution').addEventListener('click', fill_solution)

setb()
</py-script>
</body>
</html>
